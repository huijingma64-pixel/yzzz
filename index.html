<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>电子书（支持手势控制版）</title>
<style>
    body { margin: 0; padding: 0; width: 100vw; height: 100vh; background: #222; overflow: hidden; display: flex; flex-direction: column; font-family: "Microsoft YaHei", sans-serif; }
    
    .toolbar {
        height: 50px; background: #333; color: white; display: flex; align-items: center; justify-content: center; border-bottom: 1px solid #444; z-index: 100; user-select: none;
    }
    
    .btn { background: #0078d4; color: white; border: none; padding: 5px 15px; margin: 0 10px; border-radius: 4px; cursor: pointer; }
    .btn:hover { background: #0063b1; }
    
    .zoom-box { display: flex; align-items: center; background: #444; padding: 5px 15px; border-radius: 20px; margin: 0 20px; }
    .zoom-box span { font-size: 12px; margin-right: 10px; color: #ccc; }
    input[type=range] { width: 150px; cursor: pointer; }

    .stage {
        flex: 1; width: 100%; height: 100%; 
        display: flex; justify-content: center; align-items: center; 
        overflow: hidden; 
        position: relative;
    }

    #book-container {
        width: 800px;   
        height: 1200px; 
        background: white;
        box-shadow: 0 0 60px rgba(0,0,0,0.5); 
        transition: transform 0.1s ease-out;
        transform-origin: center center;
        z-index: 10; 
    }

    /* 这里的样式保证 iframe 撑满容器 */
    iframe { width: 100%; height: 100%; border: none; display: block; }
    
    /* === 翻页按钮样式 (穿透模式) === */
    .arrow {
        position: absolute; top: 0; bottom: 0; width: 80px; z-index: 50; 
        display: flex; align-items: center; justify-content: center;
        font-size: 40px; color: rgba(255,255,255,0.3); 
        user-select: none;
        pointer-events: none; /* 关键：让整个侧边栏都不挡鼠标 */
    }
    
    .arrow-icon {
        cursor: pointer;
        background: rgba(0,0,0,0.3);
        border-radius: 50%;
        width: 50px; height: 50px;
        display: flex; align-items: center; justify-content: center;
        transition: all 0.2s;
        pointer-events: auto; /* 关键：只让图标恢复点击 */
    }

    .arrow-icon:hover { background: rgba(0,70,150,0.8); color: white; transform: scale(1.1); }
    .left { left: 10px; }
    .right { right: 10px; }

</style>
</head>
<body>

<div class="toolbar">
    <button class="btn" onclick="changePage(-1)">上一页</button>
    <div class="zoom-box">
        <span>画面缩放:</span>
        <input type="range" min="0.3" max="2.0" step="0.05" value="0.75" oninput="setZoom(this.value)">
    </div>
    <button class="btn" onclick="changePage(1)">下一页</button>
</div>

<div class="stage">
    <div class="arrow left">
        <span class="arrow-icon" onclick="changePage(-1)">❮</span>
    </div>
    <div class="arrow right">
        <span class="arrow-icon" onclick="changePage(1)">❯</span>
    </div>
    
    <div id="book-container">
        <iframe 
            id="book-frame" 
            allow="camera; microphone; accelerometer; gyroscope" 
            allowfullscreen>
        </iframe>
    </div>
</div>

<script>
    // === 这里为了测试，我把目录逻辑稍微改一下 ===
    // 如果你要测试那个手势链接，可以在这里把 chapters 的第一个改成你的链接
    const testLink = "https://share.htmlput.com/p/m38vhy77u5?lang=zh";
    
    const folderPrefix = "OEBPS/";
    const totalChapters = 28;
    const chapters = [];
    
    // --- 临时修改：为了方便你测试，第一页设为你的手势链接 ---
    // 你正式使用时，把下面这行改回 chapters.push(folderPrefix + "toc.xhtml");
    chapters.push(testLink); 
    
    for(let i=1; i<=totalChapters; i++){
        chapters.push(folderPrefix + "yy-" + i + ".xhtml");
    }

    let current = 0; // 从 0 开始，直接显示手势页面
    const frame = document.getElementById('book-frame');
    const container = document.getElementById('book-container');

    function load(index) {
        if(index < 0) index = 0;
        if(index >= chapters.length) index = chapters.length - 1;
        current = index;
        frame.src = chapters[current];
    }
    
    function changePage(d) { load(current + d); }

    function setZoom(val) {
        container.style.transform = `scale(${val})`;
    }

    // 键盘翻页
    document.addEventListener('keydown', (e) => {
        if(e.key === 'ArrowRight') changePage(1);
        if(e.key === 'ArrowLeft') changePage(-1);
    });

    // 初始化
    load(0);
    setZoom(0.75);
</script>

</body>
</html>
